<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>
        jsPDF - Create PDFs with HTML5 JavaScript Library
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">
    </script>
</head>

<body>
    <h2 style="color:green">
        GeeksforGeeks
    </h2>
    <h3>
        Generate PDF file using jsPDF library
    </h3>


    <!-- <script src="./jspdf.umd.min.js"></script> -->
    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;

        function generateAndPrintPDF() {
            // Create new jsPDF instance
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            // Add content to PDF
            doc.setFont('helvetica');
            doc.setFontSize(16);
            doc.text('Your Document Title', 105, 20, { align: 'center' });

            doc.setFontSize(12);
            doc.text('This is a sample PDF document generated with jsPDF.', 20, 40);
            doc.text('It will open directly in Chrome print preview.', 20, 50);

            // Convert PDF to blob
            const pdfBlob = doc.output('blob');

            // Create blob URL
            const blobUrl = URL.createObjectURL(pdfBlob);
            return blobUrl;
        }

        function printPdfIframeInNewWindow() {
            // Code Snipet 1 - Open blob in new tab (this solves cors error)
            const blobUrl = generateAndPrintPDF();

            const printWindow = window.open(blobUrl, '_blank');
            if (printWindow) {
                printWindow.addEventListener('load', function () {
                    try {
                        printWindow.print();
                    } catch (e) {
                        console.error('Print Failed', e)
                    }
                }, true);
            }
            // Code Snipet 1 - end
        }

        function printPdfIframeInSameWindow() {
            // Code Snipet 2 - This is what the site is doing printing it in a iframe, but this is causing cors error. 
            const blobUrl = generateAndPrintPDF();
            //Create hidden iframe
            const printFrame = document.createElement('iframe');
            printFrame.style.display = 'none';
            document.body.appendChild(printFrame);

            printFrame.src = blobUrl;

            // // Wait for iframe to load before printing
            printFrame.onload = function () {
                try {
                    // Access iframe content
                    printFrame.contentWindow.focus();

                    // Trigger print dialog
                    printFrame.contentWindow.print();

                    // Cleanup after printing
                    setTimeout(() => {
                        document.body.removeChild(printFrame);
                        URL.revokeObjectURL(blobUrl);
                    }, 10000);
                } catch (e) {
                    console.error('Error printing:', e);
                }
            };

            // Code Snipet 2 - end
        }

        function printPdfIframeInSameWindowPost() {
            // Code Snipet 3 - To fix cors error below solution is tried, this won't work as expected
            const blobUrl = generateAndPrintPDF();
            //Create hidden iframe
            const printFrame = document.createElement('iframe');
            printFrame.style.display = 'none';
            document.body.appendChild(printFrame);

            printFrame.src = blobUrl;

            printFrame.contentWindow.postMessage('print', '*');
            printFrame.contentWindow.addEventListener('message', (event) => {
                if (event.data === 'print') {
                    printFrame.contentWindow.print();
                }
            });

            // Code Snipet 3 - end
        }

    </script>

    <button type="button" onclick="printPdfIframeInNewWindow()">Print the pdf iframe in a new window!</button>
    </br>
    <button type="button" onclick="printPdfIframeInSameWindow()">Print the pdf iframe in same window!</button>
    </br>

    <button type="button" onclick="printPdfIframeInSameWindowPost()">Print the pdf iframe in same window by
        posting!</button>
</body>

</html>